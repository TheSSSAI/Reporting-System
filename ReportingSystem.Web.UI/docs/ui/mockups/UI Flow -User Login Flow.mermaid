flowchart TD
    subgraph "User Interaction"
        A[Start: Login Page] --> B{User enters credentials}
        B --> C(User clicks 'Log In')
    end

    subgraph "Backend Authentication"
        C --> D((POST /api/v1/auth/token))
        D --> E{Credentials Valid?}
        E -- No --> F[Display 'Invalid credentials' error]
        F --> A
        E -- Yes --> G{Account Locked?}
        G -- Yes --> H[Display 'Account locked' error]
        H --> A
        G -- No --> I{2FA Enabled for User?}
    end

    subgraph "Two-Factor Authentication (2FA)"
        I -- Yes --> J[Redirect to 2FA Page]
        J --> K[User enters 6-digit code] --> L(User clicks 'Verify')
        L --> M((POST /api/v1/login/verify-2fa))
        M --> N{2FA Code Valid?}
        N -- No --> O[Display 'Invalid code' error]
        O --> J
        N -- Yes --> P{Force Password Change?}
    end

    subgraph "Final Redirection"
        I -- No --> P
        P -- Yes --> Q[Redirect to 'Change Password' Page]
        Q --> Z([End Session])
        P -- No --> R{Role is 'Administrator'?}
        R -- Yes --> S[Redirect to Control Panel Dashboard]
        S --> Z
        R -- No --> T[Redirect to Report Viewer]
        T --> Z
    end

    %% Styling
    classDef page fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#000
    classDef decision fill:#fff9c4,stroke:#fbc02d,stroke-width:2px,color:#000
    classDef error fill:#ffebee,stroke:#d32f2f,stroke-width:2px,color:#000
    classDef success fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#000
    classDef action fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#000

    class A,J,Q,S,T page
    class E,G,I,N,P,R decision
    class F,H,O error
    class C,L,D,M action