# 1 Overview

## 1.1 Diagram Id

SEQ-UJ-006

## 1.2 Name

Admin Associates Script with Report and Sees Warning

## 1.3 Description

An administrator associates an existing transformation script with a report configuration via the Control Panel. Upon successful association, the UI displays a persistent performance warning.

## 1.4 Type

üîπ UserJourney

## 1.5 Purpose

To link reusable scripts to reports and inform the admin of potential performance implications.

## 1.6 Complexity

Low

## 1.7 Priority

üü° Medium

## 1.8 Frequency

OnDemand

## 1.9 Participants

- REPO-APP-UI-005
- REPO-APP-API-001
- REPO-LIB-DATA-003

## 1.10 Key Interactions

- Admin selects a script and report and clicks 'Associate'.
- UI sends a POST request to `/api/v1/reports/{reportId}/associations` with the script ID.
- API service creates the association record in the database.
- An audit log event (`ReportScriptAssociationChanged`) is published and handled.
- API returns a 200 OK response.
- UI receives the success response and displays the persistent performance warning text.

## 1.11 Triggers

- Administrator confirms the association of a script to a report in the UI.

## 1.12 Outcomes

- The script is associated with the report in the database.
- An audit log is created for the association.
- The UI displays a clear warning about potential performance impacts.

## 1.13 Business Rules

- A persistent performance warning shall be displayed when a transformation script is added (REQ-DTR-002).
- Changes in script associations with reports must be logged (REQ-DTR-010).

## 1.14 Error Scenarios

- Invalid script or report ID results in a 404 Not Found.
- User lacks permission, resulting in a 403 Forbidden.

## 1.15 Integration Points

- Control Panel UI (React)
- Application Database

# 2.0 Details

## 2.1 Diagram Id

SEQ-UJ-006-IMPL

## 2.2 Name

Implementation: Admin Associates Script with Report and Sees Warning

## 2.3 Description

Technical sequence for an administrator associating a transformation script with a report. The sequence covers the user interaction, API communication, backend processing including database persistence and transactional auditing, and the final UI state update to display a required performance warning.

## 2.4 Participants

### 2.4.1 Frontend Application

#### 2.4.1.1 Repository Id

REPO-APP-UI-005

#### 2.4.1.2 Display Name

Control Panel UI

#### 2.4.1.3 Type

üîπ Frontend Application

#### 2.4.1.4 Technology

React 18, TypeScript, Axios

#### 2.4.1.5 Order

1

#### 2.4.1.6 Style

| Property | Value |
|----------|-------|
| Shape | actor |
| Color | #3498DB |
| Stereotype | UI |

### 2.4.2.0 API Gateway / Application Host

#### 2.4.2.1 Repository Id

REPO-APP-API-001

#### 2.4.2.2 Display Name

Transformation API

#### 2.4.2.3 Type

üîπ API Gateway / Application Host

#### 2.4.2.4 Technology

ASP.NET Core 8, C#

#### 2.4.2.5 Order

2

#### 2.4.2.6 Style

| Property | Value |
|----------|-------|
| Shape | component |
| Color | #2ECC71 |
| Stereotype | API |

### 2.4.3.0 Data Persistence Layer

#### 2.4.3.1 Repository Id

REPO-LIB-DATA-003

#### 2.4.3.2 Display Name

Data Access Library

#### 2.4.3.3 Type

üîπ Data Persistence Layer

#### 2.4.3.4 Technology

Entity Framework Core 8

#### 2.4.3.5 Order

3

#### 2.4.3.6 Style

| Property | Value |
|----------|-------|
| Shape | database |
| Color | #F39C12 |
| Stereotype | Repository |

## 2.5.0.0 Interactions

### 2.5.1.0 User Interaction

#### 2.5.1.1 Source Id

REPO-APP-UI-005

#### 2.5.1.2 Target Id

REPO-APP-UI-005

#### 2.5.1.3 Message

User selects a script and a report, then clicks the 'Associate' button.

#### 2.5.1.4 Sequence Number

1

#### 2.5.1.5 Type

üîπ User Interaction

#### 2.5.1.6 Is Synchronous

‚úÖ Yes

#### 2.5.1.7 Return Message

UI enters a loading state and prepares the API request.

#### 2.5.1.8 Has Return

‚úÖ Yes

#### 2.5.1.9 Is Activation

‚úÖ Yes

#### 2.5.1.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | DOM Event |
| Method | onClick |
| Parameters | Event object containing target element. Component ... |
| Authentication | N/A |
| Error Handling | Button should be disabled if no script or report i... |
| Performance | Sub-50ms response time for UI state update. |

### 2.5.2.0 API Request

#### 2.5.2.1 Source Id

REPO-APP-UI-005

#### 2.5.2.2 Target Id

REPO-APP-API-001

#### 2.5.2.3 Message

Sends request to create a new script-report association.

#### 2.5.2.4 Sequence Number

2

#### 2.5.2.5 Type

üîπ API Request

#### 2.5.2.6 Is Synchronous

‚úÖ Yes

#### 2.5.2.7 Return Message

Returns 200 OK on success, or an error status code (403, 404, 500).

#### 2.5.2.8 Has Return

‚úÖ Yes

#### 2.5.2.9 Is Activation

‚úÖ Yes

#### 2.5.2.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS |
| Method | POST /api/v1/reports/{reportId}/associations |
| Parameters | URL path contains `reportId`. Request body is JSON... |
| Authentication | JWT Bearer token required. |
| Error Handling | Client-side Axios instance handles HTTP error code... |
| Performance | Client timeout is set to 30 seconds. |

### 2.5.3.0 Security Checkpoint

#### 2.5.3.1 Source Id

REPO-APP-API-001

#### 2.5.3.2 Target Id

REPO-APP-API-001

#### 2.5.3.3 Message

ASP.NET Core middleware validates JWT and authorizes user role.

#### 2.5.3.4 Sequence Number

3

#### 2.5.3.5 Type

üîπ Security Checkpoint

#### 2.5.3.6 Is Synchronous

‚úÖ Yes

#### 2.5.3.7 Return Message

Proceeds to controller if valid, otherwise aborts with 401/403.

#### 2.5.3.8 Has Return

‚úÖ Yes

#### 2.5.3.9 Is Activation

‚ùå No

#### 2.5.3.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | Authentication & Authorization Middleware |
| Parameters | HttpContext |
| Authentication | Validates token signature, issuer, and expiry. Che... |
| Error Handling | If checks fail, the middleware short-circuits the ... |
| Performance | Sub-millisecond operation. |

### 2.5.4.0 Method Call

#### 2.5.4.1 Source Id

REPO-APP-API-001

#### 2.5.4.2 Target Id

REPO-LIB-DATA-003

#### 2.5.4.3 Message

Invokes service to create association, which validates existence of entities.

#### 2.5.4.4 Sequence Number

4

#### 2.5.4.5 Type

üîπ Method Call

#### 2.5.4.6 Is Synchronous

‚úÖ Yes

#### 2.5.4.7 Return Message

Returns success or throws `EntityNotFoundException`.

#### 2.5.4.8 Has Return

‚úÖ Yes

#### 2.5.4.9 Is Activation

‚úÖ Yes

#### 2.5.4.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | IReportManagementService.AssociateScriptAsync(repo... |
| Parameters | `reportId` (Guid), `scriptId` (Guid) |
| Authentication | N/A |
| Error Handling | The service will throw a custom `EntityNotFoundExc... |
| Performance | Expected latency < 50ms. |

### 2.5.5.0 Database Transaction

#### 2.5.5.1 Source Id

REPO-LIB-DATA-003

#### 2.5.5.2 Target Id

REPO-LIB-DATA-003

#### 2.5.5.3 Message

Begins database transaction. Inserts record into `ReportScriptAssociations` table. Publishes `ReportScriptAssociationChanged` domain event.

#### 2.5.5.4 Sequence Number

5

#### 2.5.5.5 Type

üîπ Database Transaction

#### 2.5.5.6 Is Synchronous

‚úÖ Yes

#### 2.5.5.7 Return Message

Audit log entry is created within the same transaction.

#### 2.5.5.8 Has Return

‚úÖ Yes

#### 2.5.5.9 Is Activation

‚ùå No

#### 2.5.5.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | DbContext.SaveChangesAsync() within a Unit of Work... |
| Parameters | The domain event is published to an in-process med... |
| Authentication | N/A |
| Error Handling | If either the association insert or the audit log ... |
| Performance | Transaction should complete in under 100ms. |

#### 2.5.5.11 Nested Interactions

- {'sourceId': 'REPO-LIB-DATA-003', 'targetId': 'REPO-LIB-DATA-003', 'message': 'Handles `ReportScriptAssociationChanged` event and calls `IAuditLogRepository.AddAsync`.', 'sequenceNumber': 5.1, 'type': 'Event Handling', 'isSynchronous': True, 'returnMessage': 'Audit log entity added to DbContext.', 'hasReturn': True, 'isActivation': False, 'technicalDetails': {'protocol': 'In-process', 'method': 'AuditLogEventHandler.Handle(event)', 'parameters': '`ReportScriptAssociationChanged` event payload containing user ID, timestamp, and entity details.', 'authentication': 'N/A', 'errorHandling': 'Exceptions in the handler will fail the parent transaction.', 'performance': 'Minimal overhead.'}}

### 2.5.6.0 API Response

#### 2.5.6.1 Source Id

REPO-APP-API-001

#### 2.5.6.2 Target Id

REPO-APP-UI-005

#### 2.5.6.3 Message

Commits transaction and returns success response.

#### 2.5.6.4 Sequence Number

6

#### 2.5.6.5 Type

üîπ API Response

#### 2.5.6.6 Is Synchronous

‚úÖ Yes

#### 2.5.6.7 Return Message



#### 2.5.6.8 Has Return

‚ùå No

#### 2.5.6.9 Is Activation

‚ùå No

#### 2.5.6.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS |
| Method | 200 OK |
| Parameters | Empty response body. |
| Authentication | N/A |
| Error Handling | N/A |
| Performance | Network latency is the main factor. |

### 2.5.7.0 State Update

#### 2.5.7.1 Source Id

REPO-APP-UI-005

#### 2.5.7.2 Target Id

REPO-APP-UI-005

#### 2.5.7.3 Message

Receives 200 OK, updates component state to reflect association, and clears loading state.

#### 2.5.7.4 Sequence Number

7

#### 2.5.7.5 Type

üîπ State Update

#### 2.5.7.6 Is Synchronous

‚úÖ Yes

#### 2.5.7.7 Return Message

Component re-renders to display the new state.

#### 2.5.7.8 Has Return

‚úÖ Yes

#### 2.5.7.9 Is Activation

‚ùå No

#### 2.5.7.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process (React) |
| Method | setState() or Redux dispatch |
| Parameters | New state object indicating successful association... |
| Authentication | N/A |
| Error Handling | N/A |
| Performance | React reconciliation should be efficient. |

### 2.5.8.0 UI Render

#### 2.5.8.1 Source Id

REPO-APP-UI-005

#### 2.5.8.2 Target Id

REPO-APP-UI-005

#### 2.5.8.3 Message

Conditionally renders the persistent performance warning based on the updated state.

#### 2.5.8.4 Sequence Number

8

#### 2.5.8.5 Type

üîπ UI Render

#### 2.5.8.6 Is Synchronous

‚úÖ Yes

#### 2.5.8.7 Return Message



#### 2.5.8.8 Has Return

‚ùå No

#### 2.5.8.9 Is Activation

‚ùå No

#### 2.5.8.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | DOM Render |
| Method | React component render cycle |
| Parameters | The component's props/state now indicate a script ... |
| Authentication | N/A |
| Error Handling | N/A |
| Performance | Rendering is optimized via React's virtual DOM. |

## 2.6.0.0 Notes

### 2.6.1.0 Content

#### 2.6.1.1 Content

REQ-DTR-002: The UI is responsible for displaying the persistent performance warning upon successful association. This is a client-side logic triggered by the API success response.

#### 2.6.1.2 Position

top-right

#### 2.6.1.3 Participant Id

REPO-APP-UI-005

#### 2.6.1.4 Sequence Number

8

### 2.6.2.0 Content

#### 2.6.2.1 Content

REQ-DTR-010: The association change is logged to an immutable audit trail. This is handled transactionally on the backend to ensure data consistency between the action and the audit log.

#### 2.6.2.2 Position

bottom-left

#### 2.6.2.3 Participant Id

REPO-LIB-DATA-003

#### 2.6.2.4 Sequence Number

5

## 2.7.0.0 Implementation Guidance

| Property | Value |
|----------|-------|
| Security Requirements | The API endpoint MUST be protected by role-based a... |
| Performance Targets | The end-to-end user-perceived latency for the asso... |
| Error Handling Strategy | The API must provide clear error responses: 403 fo... |
| Testing Considerations | End-to-end tests (Cypress/Playwright) must verify ... |
| Monitoring Requirements | The duration of the API call `POST /api/v1/reports... |
| Deployment Considerations | Any database schema changes for the association ta... |

