# 1 Overview

## 1.1 Diagram Id

SEQ-IF-001

## 1.2 Name

User Activates Software with a New License Key

## 1.3 Description

An Administrator enters a new activation key into the Control Panel. The system sends this key via a secure, direct API call to the external cloud licensing service for validation. Upon receiving a successful response, the system transitions from 'Trial Mode' or 'Grace Period' to the 'Active' state, unlocking all features.

## 1.4 Type

üîπ IntegrationFlow

## 1.5 Purpose

To allow a legitimate user to unlock the full functionality of the software after purchase.

## 1.6 Complexity

Medium

## 1.7 Priority

üö® Critical

## 1.8 Frequency

OnDemand

## 1.9 Participants

- presentationlayerreact
- apiweblayer
- application_layer
- infrastructure_layer

## 1.10 Key Interactions

- Admin enters the activation key in the Control Panel UI and submits the form.
- The React UI sends the key to a dedicated API endpoint (e.g., POST /api/v1/license/activate).
- The Application Layer receives the key.
- The Infrastructure Layer makes a secure HTTPS call to the cloud licensing service API to validate the key.
- The licensing service responds with a status like 'Valid' or 'Invalid'.
- If 'Valid', the Application Layer securely stores the new license key and updates the system's state to 'Active'.
- The API returns a success message to the UI, which then refreshes to remove any trial mode limitations or indicators.

## 1.11 Triggers

- Administrator submits a new activation key in the Control Panel.

## 1.12 Outcomes

- The system is fully activated, and all features are unlocked.
- The valid license key is stored securely in the system's configuration.
- Any grace period or trial mode indicators are removed from the UI.

## 1.13 Business Rules

- An invalid or expired key will result in an error message being displayed to the user and no change in the system's license state.

## 1.14 Error Scenarios

- The entered key is syntactically incorrect or not found by the licensing service.
- The cloud licensing service is unavailable.
- The application server lacks the necessary internet connectivity to reach the licensing service.

## 1.15 Integration Points

- Cloud-Based Licensing Service (External API)

# 2.0 Details

## 2.1 Diagram Id

SEQ-IF-001

## 2.2 Name

Implementation: Software Activation via Cloud Licensing Service

## 2.3 Description

Provides a detailed technical sequence for an Administrator activating the software. The flow starts from the React Control Panel, goes through the backend layers for processing, and integrates with an external cloud-based licensing service for key validation. The design includes comprehensive error handling using Polly, security measures for data in transit and at rest, and specific implementation details for each interaction.

## 2.4 Participants

### 2.4.1 React SPA

#### 2.4.1.1 Repository Id

presentation_layer_react

#### 2.4.1.2 Display Name

Presentation: Control Panel

#### 2.4.1.3 Type

üîπ React SPA

#### 2.4.1.4 Technology

React 18, TypeScript, Axios

#### 2.4.1.5 Order

1

#### 2.4.1.6 Style

| Property | Value |
|----------|-------|
| Shape | actor |
| Color | #4CAF50 |
| Stereotype | UI |

### 2.4.2.0 ASP.NET Core Controller

#### 2.4.2.1 Repository Id

api_web_layer

#### 2.4.2.2 Display Name

API: License Endpoint

#### 2.4.2.3 Type

üîπ ASP.NET Core Controller

#### 2.4.2.4 Technology

ASP.NET Core 8

#### 2.4.2.5 Order

2

#### 2.4.2.6 Style

| Property | Value |
|----------|-------|
| Shape | component |
| Color | #2196F3 |
| Stereotype | API Gateway |

### 2.4.3.0 .NET Service

#### 2.4.3.1 Repository Id

application_layer

#### 2.4.3.2 Display Name

Application: License Service

#### 2.4.3.3 Type

üîπ .NET Service

#### 2.4.3.4 Technology

.NET 8

#### 2.4.3.5 Order

3

#### 2.4.3.6 Style

| Property | Value |
|----------|-------|
| Shape | component |
| Color | #FFC107 |
| Stereotype | Business Logic |

### 2.4.4.0 .NET Infrastructure Component

#### 2.4.4.1 Repository Id

infrastructure_layer

#### 2.4.4.2 Display Name

Infrastructure: Licensing Client & Persistence

#### 2.4.4.3 Type

üîπ .NET Infrastructure Component

#### 2.4.4.4 Technology

HttpClient, Polly, EF Core 8

#### 2.4.4.5 Order

4

#### 2.4.4.6 Style

| Property | Value |
|----------|-------|
| Shape | component |
| Color | #9C27B0 |
| Stereotype | Infrastructure |

### 2.4.5.0 External API

#### 2.4.5.1 Repository Id

cloud-licensing-service

#### 2.4.5.2 Display Name

External: Cloud Licensing Service

#### 2.4.5.3 Type

üîπ External API

#### 2.4.5.4 Technology

HTTPS/JSON REST API

#### 2.4.5.5 Order

5

#### 2.4.5.6 Style

| Property | Value |
|----------|-------|
| Shape | boundary |
| Color | #795548 |
| Stereotype | External System |

## 2.5.0.0 Interactions

### 2.5.1.0 HTTP Request

#### 2.5.1.1 Source Id

presentation_layer_react

#### 2.5.1.2 Target Id

api_web_layer

#### 2.5.1.3 Message

POST /api/v1/license/activate

#### 2.5.1.4 Sequence Number

1

#### 2.5.1.5 Type

üîπ HTTP Request

#### 2.5.1.6 Is Synchronous

‚úÖ Yes

#### 2.5.1.7 Return Message

HTTP 200 OK | 400 Bad Request | 503 Service Unavailable

#### 2.5.1.8 Has Return

‚úÖ Yes

#### 2.5.1.9 Is Activation

‚úÖ Yes

#### 2.5.1.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS |
| Method | POST |
| Parameters | Request Body (JSON): { "activationKey": "user-prov... |
| Authentication | JWT Bearer Token in 'Authorization' header. |
| Error Handling | Axios interceptor handles non-200 responses, displ... |
| Performance | Client-side timeout of 30 seconds. |

### 2.5.2.0 Method Call

#### 2.5.2.1 Source Id

api_web_layer

#### 2.5.2.2 Target Id

application_layer

#### 2.5.2.3 Message

ActivateLicenseAsync(activationRequestDto)

#### 2.5.2.4 Sequence Number

2

#### 2.5.2.5 Type

üîπ Method Call

#### 2.5.2.6 Is Synchronous

‚úÖ Yes

#### 2.5.2.7 Return Message

ActivationResult { Success: bool, Message: string }

#### 2.5.2.8 Has Return

‚úÖ Yes

#### 2.5.2.9 Is Activation

‚úÖ Yes

#### 2.5.2.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | ILicenseService.ActivateLicenseAsync |
| Parameters | DTO containing the activation key. DTO is validate... |
| Authentication | Authorization policies (e.g., 'AdministratorOnly')... |
| Error Handling | Exceptions are caught by global exception handling... |
| Performance | Negligible overhead. |

### 2.5.3.0 Method Call

#### 2.5.3.1 Source Id

application_layer

#### 2.5.3.2 Target Id

infrastructure_layer

#### 2.5.3.3 Message

ValidateKeyAsync(activationKey)

#### 2.5.3.4 Sequence Number

3

#### 2.5.3.5 Type

üîπ Method Call

#### 2.5.3.6 Is Synchronous

‚úÖ Yes

#### 2.5.3.7 Return Message

LicenseValidationResult { IsValid: bool, Details: object, Error: string }

#### 2.5.3.8 Has Return

‚úÖ Yes

#### 2.5.3.9 Is Activation

‚úÖ Yes

#### 2.5.3.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | ILicensingServiceClient.ValidateKeyAsync |
| Parameters | string activationKey |
| Authentication | N/A |
| Error Handling | The implementation in the infrastructure layer is ... |
| Performance | Depends on the latency of the external call. |

### 2.5.4.0 External API Call

#### 2.5.4.1 Source Id

infrastructure_layer

#### 2.5.4.2 Target Id

cloud-licensing-service

#### 2.5.4.3 Message

POST /v2/validate_key

#### 2.5.4.4 Sequence Number

4

#### 2.5.4.5 Type

üîπ External API Call

#### 2.5.4.6 Is Synchronous

‚úÖ Yes

#### 2.5.4.7 Return Message

HTTP 200 OK | 400 Bad Request | 401 Unauthorized

#### 2.5.4.8 Has Return

‚úÖ Yes

#### 2.5.4.9 Is Activation

‚úÖ Yes

#### 2.5.4.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | HTTPS/TLS 1.2+ |
| Method | POST |
| Parameters | Request Body (JSON): { "key": "..." }. Headers: { ... |
| Authentication | Vendor-specific API Key passed in a secure header. |
| Error Handling | Wrapped in a Polly Resilience Policy (Retry + Circ... |
| Performance | Network latency + external service processing time... |

### 2.5.5.0 Method Call

#### 2.5.5.1 Source Id

application_layer

#### 2.5.5.2 Target Id

infrastructure_layer

#### 2.5.5.3 Message

UpdateLicenseStateAsync(newLicense)

#### 2.5.5.4 Sequence Number

5

#### 2.5.5.5 Type

üîπ Method Call

#### 2.5.5.6 Is Synchronous

‚úÖ Yes

#### 2.5.5.7 Return Message

Task (void)

#### 2.5.5.8 Has Return

‚úÖ Yes

#### 2.5.5.9 Is Activation

‚ùå No

#### 2.5.5.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process |
| Method | ISystemConfigurationRepository.UpdateLicenseStateA... |
| Parameters | License object containing the validated key, statu... |
| Authentication | N/A |
| Error Handling | Repository handles database-specific exceptions (e... |
| Performance | Database write operation, expected < 50ms. |

### 2.5.6.0 Method Call

#### 2.5.6.1 Source Id

application_layer

#### 2.5.6.2 Target Id

infrastructure_layer

#### 2.5.6.3 Message

LogAuditEventAsync(auditEvent)

#### 2.5.6.4 Sequence Number

6

#### 2.5.6.5 Type

üîπ Method Call

#### 2.5.6.6 Is Synchronous

‚ùå No

#### 2.5.6.7 Return Message



#### 2.5.6.8 Has Return

‚ùå No

#### 2.5.6.9 Is Activation

‚ùå No

#### 2.5.6.10 Technical Details

| Property | Value |
|----------|-------|
| Protocol | In-process (Fire-and-forget) |
| Method | IAuditLogger.LogAuditEventAsync |
| Parameters | AuditEvent object with details: { Action: 'License... |
| Authentication | N/A |
| Error Handling | Logging failures are logged to a fallback system l... |
| Performance | Asynchronous call to avoid blocking the user respo... |

## 2.6.0.0 Notes

### 2.6.1.0 Content

#### 2.6.1.1 Content

Interaction 4 is critical. The HttpClient instance used here must be managed by HttpClientFactory. The Polly policy should be configured in Program.cs and applied via dependency injection to provide resilience against transient network or service failures.

#### 2.6.1.2 Position

right

#### 2.6.1.3 Participant Id

infrastructure_layer

#### 2.6.1.4 Sequence Number

4

### 2.6.2.0 Content

#### 2.6.2.1 Content

Upon successful validation, the license key must be encrypted (e.g., using .NET's DPAPI) by the application layer before being passed to the infrastructure layer for persistence in the SQLite database.

#### 2.6.2.2 Position

left

#### 2.6.2.3 Participant Id

application_layer

#### 2.6.2.4 Sequence Number

5

## 2.7.0.0 Implementation Guidance

| Property | Value |
|----------|-------|
| Security Requirements | 1. All communication with the external licensing s... |
| Performance Targets | 1. The P95 latency for the entire end-to-end activ... |
| Error Handling Strategy | 1. **Invalid Key (4xx from external API):** Return... |
| Testing Considerations | 1. Create an integration test suite that mocks the... |
| Monitoring Requirements | 1. Expose Prometheus metrics for the external API ... |
| Deployment Considerations | The application host machine requires outbound int... |

